<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ì¡°í˜•ëŒ€ ì†Œì›íŠ¸ë¦¬</title>
    <style>
        @font-face {
            font-family: 'DnfBitbeatV2';
            src: url('//cdn.df.nexon.com/img/common/font/DNFBitBitv2.otf') format('opentype');
            font-weight: 400;
            font-display: swap;
        }

        @font-face {
            font-family: 'GangwonEducationSaeum';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2201-2@1.0/GangwonEduSaeeum_OTFMediumA.woff') format('woff');
            font-weight: normal;
            font-display: swap;
        }

        body {
            font-family: 'GangwonEducationSaeum', sans-serif;
            color: white;
            text-align: center;
            padding-top: 40px;
            margin: 0;

            background: url('./src/tree/BG_tree.png') no-repeat center top fixed;
            background-size: auto 100vh;

            height: 100vh;
            overflow: hidden; /* ì¤‘ìš”: ì œëª©ì€ ê³ ì •, ë°‘ë§Œ ìŠ¤í¬ë¡¤ */
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            font-family: 'DnfBitbeatV2', sans-serif;
            margin-bottom: 10px;
            font-size: 60px;
            text-shadow: 0 0 10px rgba(21, 143, 15, 0.156),
                         0 0 20px rgba(21, 143, 15, 0.156);
        }

        /* íŠ¸ë¦¬ + ì¹´ë“œ ì˜ì—­ ì „ì²´ */
        #tree-container {
            width: 60%;
            height: 75vh; /* ì œëª© ì•„ë˜ë§Œ ìŠ¤í¬ë¡¤ */
            overflow: hidden; /* ë‚´ë¶€ì˜ wish-listë§Œ ìŠ¤í¬ë¡¤ */
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        /* ìœ„ì‹œ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ */
       #wish-list {
    display: flex;
    flex-direction: column;
    gap: 25px;

    width: 100%;
    height: 100%;
    overflow-y: auto;
    overflow-x: hidden;

    scroll-behavior: smooth;
    align-items: flex-start;
    padding-right: 15px;

    /* ğŸ”¥ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸°*/
    scrollbar-width: none; /* Firefox */
}
#wish-list::-webkit-scrollbar {
    display: none; /* Chrome / Safari */
}

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .wish-card {
            font-family: 'GangwonEducationSaeum', sans-serif;
            font-size: 38px;
            width: 100%;
            background: rgba(255, 255, 255, 0.13);
            padding: 8px 18px;
            animation: fadeIn 0.4s ease-out;
            box-sizing: border-box;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to   { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>

<body>

    <h1>ì¡°í˜•ëŒ€ ì†Œì›íŠ¸ë¦¬</h1>

    <div id="tree-container">
        <div id="wish-list"></div>
    </div>

    <script>
        const WSS_URL = "wss://12spzvb7ok.execute-api.ap-southeast-2.amazonaws.com/production/";
        const ws = new WebSocket(WSS_URL);

        // ì „ì²´ íˆìŠ¤í† ë¦¬ ì €ì¥
        let allWishes = JSON.parse(localStorage.getItem("wishHistory") || "[]");

        const MAX_WISHES_DISPLAYED = 10;
        const wishList = document.getElementById("wish-list");

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ì¡´ íˆìŠ¤í† ë¦¬ ì¤‘ ë§ˆì§€ë§‰ 10ê°œ í‘œì‹œ
        function renderInitialWishes() {
            const recent = allWishes.slice(-MAX_WISHES_DISPLAYED);
            recent.forEach(text => {
                const div = document.createElement("div");
                div.className = "wish-card";
                div.textContent = text;
                wishList.appendChild(div);
            });

            // í™”ë©´ ìµœì‹ í™”
            wishList.scrollTop = wishList.scrollHeight;
        }
        renderInitialWishes();

        ws.onopen = () => console.log("ğŸ“¡ ì„œë²„ ì—°ê²° ì„±ê³µ! (tree)");

        ws.onmessage = (event) => {
            console.log("ğŸ“© ë©”ì‹œì§€ ë„ì°©:", event.data);

            try {
                const data = JSON.parse(event.data);
                if (data.message) {
                    addWish(data.message);
                }
            } catch (e) {
                console.log("ë¬´ì‹œëœ ë©”ì‹œì§€:", event.data);
            }
        };

        // ìƒˆë¡œìš´ ë©”ì‹œì§€ ì²˜ë¦¬
        function addWish(text) {
            // ì €ì¥
            allWishes.push(text);
            localStorage.setItem("wishHistory", JSON.stringify(allWishes));

            // ì¹´ë“œ ìƒì„±
            const div = document.createElement("div");
            div.className = "wish-card";
            div.textContent = text;
            wishList.appendChild(div);

            // ìë™ ì•„ë˜ ìŠ¤í¬ë¡¤
            wishList.scrollTop = wishList.scrollHeight;

            // 10ê°œ ì´ìƒì´ë©´ ë§¨ ìœ„ ì œê±°
            if (wishList.children.length > MAX_WISHES_DISPLAYED) {
                wishList.removeChild(wishList.children[0]);
            }
        }
    </script>

</body>
</html>
